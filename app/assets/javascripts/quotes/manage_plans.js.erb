function plan_test(plan, criteria){
  result = true
  critters = criteria.length
  for (var j=0; j< critters; j++){
    criteria_type = criteria[j][0]
    criteria_value = criteria[j][1]
    if ((criteria_type == 'carriers') && (criteria_value != plan[5]))   {result=false; break; }
    if ((criteria_type == 'metals') && (criteria_value != plan[0]))     {result=false; break; }
    if ((criteria_type == 'plan_types') && (criteria_value != plan[2])) {result=false; break; }
    if ((criteria_type == 'nationwide') && (criteria_value != String(plan[6]))) {result=false; break; }
    if ((criteria_type == 'dc_in_network') && (criteria_value != String(plan[7]))) {result=false; break; }
  }
   if (plan[3] > deductible_value) {result=false}
  return result
}

function set_plan_counts() {
    $('#show_plan_criteria_count').text('Plans that meet your criteria: ' + String(window.available_plans))
    $('#show_plan_selected_count').text('You have selected ' + String($('.btn.active').size()) +' plans.')
}

function toggle_plans(){
  window.criteria = []
  $.each($('.plan_selectors .active'), function() {
      criteria_type = this.parentNode.id
      criteria_value = this.id
      if (criteria_value != 'any') {window.criteria.push([criteria_type,criteria_value])}
    })
  window.available_plans = 0
  for(var i = 0; i < plan_count; i++) {
      plan = window.select_plans[i]
      value = "[value~=" + plan[4] + "]"
      display = plan_test(plan, window.criteria) ? 'inline' : 'none'
      $(value).parent().css('display', display)
      if (display=='inline') {window.available_plans += 1}
  }

  // Show number of available plans based on the selection criteria 
  $('#x-of-plans').html($('#quote-plan-list > label:visible').length);
  set_plan_counts()
}

function reset_selected_plans(){
    $.each($('.plan_buttons .btn.active input'), function(){
    $(this).prop('checked', false)
    $(this).parent().removeClass('active')
    })
    set_plan_counts()
    $('[aria-labelledby="compare_costs"]').html('')
    $('[aria-labelledby="compare_benefits"]').html('')
    setTimeout( function(){
      $('[aria-controls="plan-selection-mgmt"]').attr('aria-expanded', true)
      $('#plan-selection-mgmt').addClass('in')
    }, 0)
}

$('#reset_selected').on('click', reset_selected_plans)